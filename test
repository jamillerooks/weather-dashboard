var dateEl = document.querySelector('#date');
var dayEl = document.querySelector('.day');
var cityInputEl = document.getElementById('#city-input');
var citySearchHistoryEl = document.querySelector('#searchesHistory');
var currentPictureEl = document.querySelector('#current-picture');
//var weatherForecastEl = `https://openweathermap.org/img/w/${weather.weather[0].icon}.png`;
var currentTempEl = document.querySelector('#current-temp');
var currentWindEl = document.querySelector('#current-wind');
var currentHumidityEl = document.querySelector('#current-humidity');
var uvIndexEl = document.querySelector('#uvIndex');
var uvColorEl = document.querySelector('#uv-color');
var lat;
var lon;
var searches = []


            


const api = {
 key: "6adbeffd52b6bf558ada7f0bafb51e52",
  base: "https://api.openweathermap.org/data/2.5/"
}

const searchBox = document.querySelector('#city-input');
searchBtn.addEventListener('click',  citySearch);



function setQuery(evt){
 getResults(searchBox.value);
  }

function getResults(query){
  
  fetch(`${api.base}weather?q=${query}&units=imperial&APPID=${api.key}`)
  .then(weather =>{
    return weather.json();
  }) .then(displayResults);
}
  
//Populate data in the side panel
function displayResults(weather){
  //City
  console.log(weather);
  let city = document.querySelector('#cityName');
  city.innerText =`${weather.name}`;
  lat = weather.coord.lat;
  lon = weather.coord.lon;
}

  //Date
  let date = document.querySelector('#date');
  var current = $.now();
  var maxDate = new Date(current);
  var currentDate =maxDate.toString();
  date.innerHTML = (currentDate);

  //Temp
  let temp = document.querySelector('#current-temp');
  temp.innerHTML = `<span> Temp </span>${Math.round(weather.main.temp)}<span>℉</span>`;

  //Humidity
  let humidity = document.querySelector('#current-humidity');
  humidity.innerHTML = `<span> Humidity </span>${weather.main.humidity}<span>%</span>`;
  
   //Wind
   let wind = document.querySelector('#current-wind');
   wind.innerHTML = `<span> Wind </span>${Math.round(weather.wind.speed)}<span>mph</span>`;

  //weather Symbol
  let weatherIcon = `https://openweathermap.org/img/w/${weather.weather[0].icon}.png`;
  currentPictureEl.setAttribute("src", weatherIcon); 


  
  Local Storage
  localStorage.setItem("#cityName", weather.name);
  localStorage.setItem("lat", weather.coord.lat);
  localStorage.setItem("lon", weather.coord.lon);  
};

// var saveSearches = function() {
//   localStorage.setItem("searchHistory", (searches));
//   localStorage.setItem("#cityName", weather.name);
//   localStorage.setItem("lat", weather.coord.lat);
//   localStorage.setItem("lon", weather.coord.lon);
//};
//   var loadSearches = function() {
//   searches = localStorage.getItem("searches");
//   $("#cityName").val(localStorage.getItem('searchHistory'));//Atlanta
//   $("#lat").val(localStorage.getItem('searchHistory'));//33.749
//   $("#lon").val(localStorage.getItem('searchHistory'));//-84.388

//   if (!searches) {
//     searches = [];
//   }

//   for (var i = 0; i < searches.length; i++) {
//     var searchItem = $("<li>")
//       .addClass("list-group-item")
//       .text(searches[i]);

//     $(".list-group").prepend(searchItem);
//   }
// };

//   loadSearches();
//     displayResults($("#cityName").val());
//     searches.push($("#cityName").val());
//     var searchItem = $("<li>")
//     .addClass("list-group-item")
//     .text($("#cityName").val());
  
//     $(".list-group").prepend(searchItem);
//     saveSearches();

//   $(".list-group").on("click", "li", function () {
//   displayResults($(this).text())
// });


function showWeatherData(data){
  
for (i = 0; i < 6; i++) {
  let date = new Date(forecast[i + 1].dt * 1000).toLocaleString();
      date.innerHTML = day;
    
      var dayTemp = document.getElementById(`day${i}Temp`);
      dayTemp.innerHTML = `<span> Temp </span>${Math.round(forecast[i].list.main.temp)}<span>℉</span>`;

      //Humidity
      var dayHumidity = document.getElementById(`day${i}Humidity`);
      dayHumidity.innerHTML = `<span> Humidity </span>${forecast[i].list.main.humidity}<span>%</span>`;

      //Wind
      var dayWind = document.getElementById(`day${i}Wind`);
      dayWind.innerHTML = `<span> Wind </span>${Math.round(forecast[i].list.wind.speed)}<span>mph</span>`;

      //weather Symbol
      var dayIcon = document.getElementById(`day${i}Icon`);
      dayIcon.setAttribute("src", "http://openweathermap.org/img/wn/") + "png";


                    var uvIndex = uvData.value;
                  if (uvIndex >= 8) {
                      $("#uvIndex").html("UV Index: <span class='bg-danger'>" + uvIndex + "</span>");
                } else if (uvIndex >= 3) {
                      $("#uvIndex").html("UV Index: <span class='bg-warning'>" + uvIndex + "</span>");
                } else {
                      $("#uvIndex").html("UV Index: <span class='bg-success'>" + uvIndex + "</span>");
                }
                
                }
                


                //The weather dashboard needs the current weather and the 5 day forecast.
//The current forecast uses the weather API and the 5 Day forecast uses the OneCall API

//Current Weather
const timeEl =document.getElementById('time');
const dateEl = document.querySelector('#date');
const currentWeatherItemsEl = document.getElementById ('currentWeatherItems')
const timezone = document.getElementById('time-zone');
const fiveDayForecastEl = document.getElementById('fiveDayForecast');
const currentTempEl = document.getElementById('current-temp');

//Search Information 
let searchBtn = document.getElementById("searchBtn");
let cityInputEl = document.getElementById("city-input");
const weatherForecastEl = document.getElementById('weather-forecast')
var cityHistoryBtn = document.getElementById("searchHistory");
var apiUrl = "https://api.openweathermap.org";
var apiKey = "6adbeffd52b6bf558ada7f0bafb51e52";
var searchHistory = [];

function getCity(locationData) {
  
  var lat = locationData.lat;
  var lon = locationData.lon;
  var city = locationData.name;
  
  let {latitude, longitude} = success.coords;
  
  getWeatherData()
  function getWeatherData () {
    navigator.geolocation.getCurrentPosition((success) => {
  
      let {latitude, longitude} = success.coords;
      
  
  fetch(`https://api.openweathermap.org/data/2.5/onecall?lat=${latitude}&lon=${longitude}&exclude={part}&appid=${apiKey}`)
  .then(res => res.json())
  .then(data => {
    console.log(data)
    getWeatherData(data);
  })
      })
      .then(function (data) {
        showWeatherData(city, data.current, data.timezone);
        fiveDayForecastEl(data.daily, data.timezone);
      })
      .catch(function (err) {
        console.error(err);
      });
    }

function getGeo(search) {
  var url = apiUrl + "/geo/1.0/direct?q="+ search + "&limit=5&appid=" + apiKey;
      fetch(url)
          .then(function (response) {
              return response.json();
          })
          .then(function (data) {
              if (!data[0]) {
                alert("Enter City");
              } else {
                storeHistory(search)
                getCity(data[0]);
                return;
              }
          })
          .catch(function (err) {
              console.log("error: " + err);
          });
        
        function citySearch(event){
          
    if (!cityInputEl.value) {
        return;
    };
    event.preventDefault();      
    var search = cityInputEl.value.trim();
    getLocation(search);
    cityInputEl.value = "enter city name...";
    
};

function citySearch(event){
          
  if (!cityInputEl.value) {
      return;
  };
  event.preventDefault();      
  var search = cityInputEl.value.trim();
  getLocation(search);
  cityInputEl.value = "Enter city";
  
};
let cityInputEl = document.getElementById("city-input");
          
};

function citySearchHistory(event) {
  if (!event.target.matches("historyBtn")) {
    return;
  };
  var btn = event.target;
  var search = btn.getAttribute("data-search");
  getLocation(search);
};

// //Date
// setInterval(() => {
//   const time = new Date();
//   const month = time.getMonth();
//   const date = time.getDate();
//   const day = time.getDay();
//   const hour = time.getHours();
//   const minutes = time.getMinutes();
//   const hoursIn12HrFormat = hour> 13 ? hour %12: hour
//   const ampm =  hour >=12 ? 'PM' : 'AM'
//   timeEl.innerHTML = hoursIn12HrFormat + ':' + minutes + ' ' + `<span id="am-pm">${ampm}</span>`
  
// },1000);

function showWeatherData (data){
let {humidity, wind_speed, temp, uvi } = data.current;

currentWeatherItemsEl.innerHTML =
`<div class="col-12">
									<span class="align-middle" id="cityName" class="current-weather-items">
									</span>

									<div id="time-zone" id="time"></div>
									<img src="https://openweathermap.org/img/w/${day.weather[0].icon}.png" id="current-picture"/>
									<div id="date"> </div>
								</div>
							</div>
							<div class="row">
								<div class="col-12 flex">
									<p id="uvIndex">UV Index ${uvi}</p><div id="uv-color" class="uvCard"></div>
								</div>
							</div>
							<div class="row">
								<div class="col-12">
									<p id="current-temp"><span> Temp </span>${Math.round(temp)}<span>℉</span>Temp</p>
								</div>
							</div>
							<div class="row">
								<div class="col-12">
									<p id="current-wind"><span> Wind </span>${Math.round(wind_speed)}<span>mph</span></p>
								</div>
							</div>
							<div class="row">
								<div class="col-12">
									<p id="current-humidity"><span> Humidity </span>${humidity}<span>%</span></p>
								</div>`

if (weather.uvi < 3){
  uv-color.setAttribute("class", "uvcard green");
} else if (weather.uvi < 6){
  uv-color.setAttribute("class", "uvcard yellow");
} else if (weather.uvi < 8){
  uv-color.setAttribute("class", "uvcard orange");
} else{
  uv-color.setAttribute("class", "uvcard red");
};
}  
  
let fiveDayForecast = ''
data.daily.forEach((day, idx) =>{
  if(idx == 0){

  }else{
    fiveDayForecast += `
    <div
							 id="weather-forecast" class="col weather-forecast day bg-primary text-white ml-3 mb-3 rounded">
							 <div class="weather-forecast-item">
								<h3  id ="day1" class="day">${window.moment(day.dt*1000).format('MM/dd/yyyy')}</h3>
								<img src="https://openweathermap.org/img/w/${weather.weather[0].icon}.png" id="day1Icon">
								<div id="day1Temp">  <span>℉</span></div>
								<div id="day1Wind"> </div>
								<div id="day1Humidity">  </div>
							 </div>
						</div>
    `
  };
  function storeHistory(search) {
    searchHistory.push(search);
    localStorage.setItem("searchHistory", JSON.stringify(searchHistory));
    console.log(searchHistory);
    
    createHistoryList();
};

function createHistoryList() {
  let cityHistory = document.getElementById("searchHistory");
  cityHistory.innerHTML = "";
  //
  for (var i = searchHistory.length - 1; i >= searchHistory.length - 5; i--) {
      if (i < 0){
        return;
      };

      var btn = document.createElement("button");
      btn.setAttribute("type", "button");
      btn.setAttribute("class", "history");
      var space = document.createElement("br");
      btn.setAttribute("data-search", searchHistory[i]);
      btn.textContent = searchHistory[i];
      cityHistory.append(btn);
      cityHistory.append(space);

  };
  function getItemsFromStorage() {
    var savedHistory = localStorage.getItem("searchHistory");
    console.log(savedHistory);
    if (savedHistory) {
        searchHistory = JSON.parse(savedHistory);
    };
    // call to generate search history buttons
    createHistoryList();
};
  getItemsFromStorage();
  searchBtn.addEventListener('click',  citySearch);
  cityHistoryBtn.addEventListener("click", citySearchHistory);

var dateEl = document.querySelector('#date');
var dayEl = document.querySelector('.day');
var cityInputEl = document.getElementById('city-input');
var searchBtn = document.getElementById('searchBtn');
var citySearchBtn = document.querySelector('#city-search-history');





var uvIndexEl = document.querySelector('#uvIndex');
var uvColorEl = document.querySelector('#uv-color');
var searchHistory = [];














const api = {
  key: "6adbeffd52b6bf558ada7f0bafb51e52",
  base: "https://api.openweathermap.org/data/2.5/"
}

const searchBox = document.querySelector('#city-input');
searchBtn.addEventListener('click',  setQuery);



function setQuery(evt){
 getResults(searchBox.value);
  }

function getResults(query){
  
  fetch(`${api.base}weather?q=${query}&units=imperial&APPID=${api.key}`)
  .then(weather =>{
    return weather.json();
  }) .then(displayResults);
}
  
//Populate data in the side panel
function displayResults(weather){
  
  console.log(weather);
  let city = document.querySelector('#cityName');
  city.innerHTML =`${weather.name}`;
   lat = weather.coord.lat;
   lon = weather.coord.lon;
}

  //Date
  let date = document.querySelector('#date');
  var current = $.now();
  var maxDate = new Date(current);
  var currentDate =maxDate.toString();
  date.innerHTML = (currentDate);

  //Temp
  var currentTempEl = document.querySelector('#current-temp');
  currentTempEl.innerHTML = `<span> Temp </span>${Math.round(weather.main.temp)}<span>℉</span>`;

  //Humidity
  var currentHumidityEl = document.querySelector('#current-humidity');
  currentHumidityEl.innerHTML = `<span> Humidity </span>${weather.main.humidity}<span>%</span>`;
  
   //Wind
   var currentWindEl = document.querySelector('#current-wind');
   currentWindEl.innerHTML = `<span> Wind </span>${Math.round(weather.wind.speed)}<span>mph</span>`;

  //weather Symbol
  let currentPictureEl = `https://openweathermap.org/img/w/${weather.weather[0].icon}.png`;
  currentPictureEl.setAttribute("src", weatherIcon); 


  
  //Local Storage
  localStorage.setItem("#cityName", weather.name);
//   localStorage.setItem("lat", weather.coord.lat);
//   localStorage.setItem("lon", weather.coord.lon);  
// };

// // var saveSearches = function() {
// //   localStorage.setItem("searchHistory", (searches));
// //   localStorage.setItem("#cityName", weather.name);
// //   localStorage.setItem("lat", weather.coord.lat);
// //   localStorage.setItem("lon", weather.coord.lon);
// //};
// //   var loadSearches = function() {
// //   searches = localStorage.getItem("searches");
// //   $("#cityName").val(localStorage.getItem('searchHistory'));//Atlanta
// //   $("#lat").val(localStorage.getItem('searchHistory'));//33.749
// //   $("#lon").val(localStorage.getItem('searchHistory'));//-84.388

// //   if (!searches) {
// //     searches = [];
// //   }

// //   for (var i = 0; i < searches.length; i++) {
// //     var searchItem = $("<li>")
// //       .addClass("list-group-item")
// //       .text(searches[i]);

// //     $(".list-group").prepend(searchItem);
// //   }
// // };

// //   loadSearches();
// //     displayResults($("#cityName").val());
// //     searches.push($("#cityName").val());
// //     var searchItem = $("<li>")
// //     .addClass("list-group-item")
// //     .text($("#cityName").val());
  
// //     $(".list-group").prepend(searchItem);
// //     saveSearches();

// //   $(".list-group").on("click", "li", function () {
// //   displayResults($(this).text())
// // });


// 5 Day forecast
// fetch((`${api.base}forecast?q=${query}&units=imperial&APPID=${api.key}`)
// .then(forecast =>{
  
// for (i = 0; i < 6; i++) {
//   let date = new Date(forecast[i + 1].dt * 1000).toLocaleString();
//       date.innerHTML = day;
    
//       var dayTemp = document.getElementById(`day${i}Temp`);
//       dayTemp.innerHTML = `<span> Temp </span>${Math.round(forecast[i].list.main.temp)}<span>℉</span>`;

//       //Humidity
//       var dayHumidity = document.getElementById(`day${i}Humidity`);
//       dayHumidity.innerHTML = `<span> Humidity </span>${forecast[i].list.main.humidity}<span>%</span>`;

//       //Wind
//       var dayWind = document.getElementById(`day${i}Wind`);
//       dayWind.innerHTML = `<span> Wind </span>${Math.round(forecast[i].list.wind.speed)}<span>mph</span>`;

//       //weather Symbol
//       var dayIcon = document.getElementById(`day${i}Icon`);
//       dayIcon.setAttribute("src", "http://openweathermap.org/img/wn/") + "png";

//       return forecast.json();
// }
    